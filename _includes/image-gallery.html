<style>
    .image-gallery_{{include.id}} {
        display: flex;
        overflow: scroll;
        flex-wrap: wrap;
        justify-content: space-around;
        padding-bottom: 50px;
        width: 80vw;
        margin: auto;
    }

    .img_item_{{include.id}} {
        text-align: center;
        padding-bottom: 20px;
        display: inline-block;
    }

    .gallery_image_{{include.id}} {
        height: 50vh;
        margin-right: 20px;
        margin-bottom: 10px;
    }

    .descriptions_{{include.id}} {
        text-align: center;
    }

    .flex-break-{{include.id}} {
        flex-basis: 100%;
    }

    #gallery_title_{{include.id}} {
        text-decoration: underline;
        text-align: center;
        padding-bottom: 20px;
    }

    #gallery_content_{{include.id}} {
        width: 50vw;
        text-align: center;
        padding-bottom: 20px;
    }
</style>
<div class="image-gallery_{{include.id}}">
<h1 id="gallery_title_{{include.id}}"></h1><div class="flex-break-{{include.id}}"></div>
<p id="gallery_content_{{include.id}}"></p><div class="flex-break-{{include.id}}"></div>
    {% assign sorted = site.static_files | sort: 'date' | reverse %}
    {% for file in sorted %}
        {% if file.path contains include.folder %}
            {% if file.extname == '.png' or file.extname == '.jpg' or file.extname == '.jpeg' or file.extname == '.heic' %}
                {% assign filenameparts = file.path | split: "/" %}
                {% assign filename = filenameparts | last | replace: file.extname,"" %}
                <div class="img_item_{{include.id}}"><a href="{{ file.path | relative_url }}" title="{{ filename }}">
                    <img class="gallery_image_{{include.id}}" src="{{include.folder}}{{file.name }}" alt="{{ filename }}" />
                </a><br>
            <div class="descriptions_{{include.id}}">{{filename}}</div></div>
            {% endif %}
        {% endif %}
    {% endfor %}
</div>
<script>
    let image_elems_{{include.id}} = [];

    fetch("/assets/json/gallery_{{include.id}}.json")
    .then(response => response.json())
    .then(gallery_data => {
        console.log(gallery_data);
        let to_delete = [];
        for (const desc of document.getElementsByClassName("descriptions_{{include.id}}")) {
            image_elems_{{include.id}}.push({
                image_tag: desc.previousSibling.previousSibling.previousSibling.children[0],
                desc_elem: desc
            });
            let id = desc.innerText;
            let idx = Object.keys(gallery_data).indexOf(id);
            if (idx != -1) {
                desc.innerHTML = Object.values(gallery_data)[idx].description;
            } else {
                to_delete.push(desc.parentElement);
            }
        }

        to_delete.forEach(element => {
            element.remove();
        });

        document.getElementById("gallery_title_{{include.id}}").innerText = gallery_data.title;
        document.getElementById("gallery_content_{{include.id}}").innerHTML = gallery_data.content || "";

        resize_captions_{{include.id}}();
    });

    document.addEventListener("resize", resize_captions_{{include.id}});

    function resize_captions_{{include.id}}() {
        for (const elem of image_elems_{{include.id}}) {
            elem.desc_elem.setAttribute("style", `width: ${elem.image_tag.style.width}px; text-align: center;`);
        }
    }

    document.getElementById("default_layout_content_container").setAttribute("class", "mt-5");
</script>