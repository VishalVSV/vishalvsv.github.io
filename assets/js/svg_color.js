"use strict";class Color{constructor(t,s,e){this.set(t,s,e)}toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`}set(t,s,e){this.r=this.clamp(t),this.g=this.clamp(s),this.b=this.clamp(e)}hueRotate(t=0){t=t/180*Math.PI;let s=Math.sin(t),e=Math.cos(t);this.multiply([.213+.787*e-.213*s,.715-.715*e-.715*s,.072-.072*e+.928*s,.213-.213*e+.143*s,.715+.285*e+.14*s,.072-.072*e-.283*s,.213-.213*e-.787*s,.715-.715*e+.715*s,.072+.928*e+.072*s])}grayscale(t=1){this.multiply([.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)])}sepia(t=1){this.multiply([.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)])}saturate(t=1){this.multiply([.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t])}multiply(t){let s=this.clamp(this.r*t[0]+this.g*t[1]+this.b*t[2]),e=this.clamp(this.r*t[3]+this.g*t[4]+this.b*t[5]),i=this.clamp(this.r*t[6]+this.g*t[7]+this.b*t[8]);this.r=s,this.g=e,this.b=i}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-.5*t+.5)}linear(t=1,s=0){this.r=this.clamp(this.r*t+255*s),this.g=this.clamp(this.g*t+255*s),this.b=this.clamp(this.b*t+255*s)}invert(t=1){this.r=this.clamp(255*(t+this.r/255*(1-2*t))),this.g=this.clamp(255*(t+this.g/255*(1-2*t))),this.b=this.clamp(255*(t+this.b/255*(1-2*t)))}hsl(){let t,s,e=this.r/255,i=this.g/255,l=this.b/255,r=Math.max(e,i,l),h=Math.min(e,i,l),a=(r+h)/2;if(r===h)t=s=0;else{let o=r-h;switch(s=a>.5?o/(2-r-h):o/(r+h),r){case e:t=(i-l)/o+(i<l?6:0);break;case i:t=(l-e)/o+2;break;case l:t=(e-i)/o+4}t/=6}return{h:100*t,s:100*s,l:100*a}}clamp(t){return t>255?t=255:t<0&&(t=0),t}}class Solver{constructor(t){this.target=t,this.targetHSL=t.hsl(),this.reusedColor=new Color(0,0,0)}solve(){let t=this.solveNarrow(this.solveWide());return{values:t.values,loss:t.loss,filter:this.css(t.values)}}solveWide(){const t=5,s=15,e=[60,180,18e3,600,1.2,1.2];let i={loss:1/0};for(let l=0;i.loss>25&&l<3;l++){let l=[50,20,3750,50,100,100],r=this.spsa(t,e,s,l,1e3);r.loss<i.loss&&(i=r)}return i}solveNarrow(t){const s=t.loss,e=2,i=s+1,l=[.25*i,.25*i,i,.25*i,.2*i,.2*i];return this.spsa(s,l,e,t.values,500)}spsa(t,s,e,i,l){function r(t,s){let e=100;return 2===s?e=7500:4!==s&&5!==s||(e=200),3===s?t>e?t%=e:t<0&&(t=e+t%e):t<0?t=0:t>e&&(t=e),t}const h=1,a=.16666666666666666;let o=null,n=1/0,u=new Array(6),c=new Array(6),g=new Array(6);for(let b=0;b<l;b++){let l=e/Math.pow(b+1,a);for(let t=0;t<6;t++)u[t]=Math.random()>.5?1:-1,c[t]=i[t]+l*u[t],g[t]=i[t]-l*u[t];let p=this.loss(c)-this.loss(g);for(let e=0;e<6;e++){let a=p/(2*l)*u[e],o=s[e]/Math.pow(t+b+1,h);i[e]=r(i[e]-o*a,e)}let m=this.loss(i);m<n&&(o=i.slice(0),n=m)}return{values:o,loss:n}}loss(t){let s=this.reusedColor;s.set(0,0,0),s.invert(t[0]/100),s.sepia(t[1]/100),s.saturate(t[2]/100),s.hueRotate(3.6*t[3]),s.brightness(t[4]/100),s.contrast(t[5]/100);let e=s.hsl();return Math.abs(s.r-this.target.r)+Math.abs(s.g-this.target.g)+Math.abs(s.b-this.target.b)+Math.abs(e.h-this.targetHSL.h)+Math.abs(e.s-this.targetHSL.s)+Math.abs(e.l-this.targetHSL.l)}css(t){function s(s,e=1){return Math.round(t[s]*e)}return`filter: invert(${s(0)}%) sepia(${s(1)}%) saturate(${s(2)}%) hue-rotate(${s(3,3.6)}deg) brightness(${s(4)}%) contrast(${s(5)}%);`}}$("button.execute").click(()=>{let t=$("input.target").val().split(",");if(3!==t.length)return void alert("Invalid format!");let s,e=new Color(t[0],t[1],t[2]),i=new Solver(e).solve();s=i.loss<1?"This is a perfect result.":i.loss<5?"The is close enough.":i.loss<15?"The color is somewhat off. Consider running it again.":"The color is extremely off. Run it again!",$(".realPixel").css("background-color",e.toString()),$(".filterPixel").attr("style",i.filter),$(".filterDetail").text(i.filter),$(".lossDetail").html(`Loss: ${i.loss.toFixed(1)}. <b>${s}</b>`)});